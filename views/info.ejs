<%- include('slidebar.ejs') %>
<main id="main" class="main">
  <table class="table table-dark table-hover">
    <thead>
      <tr>
        <th scope="col">ID</th>
        <th scope="col">username</th>
        <th scope="col">email</th>
        <th scope="col">role</th>
        <th scope="col">created_at</th>
        <th scope="col">updated_at</th>
        <th scope="col">編輯</th>
      </tr>
    </thead>
    <tbody>
      <% allUser.forEach((user, index) => { %>
      <tr>
        <th scope="row"><%= user.ID%></th>
        <td><%= user.username%></td>
        <td><%= user.email%></td>
        <td><%= user.role%></td>
        <td><%= user.created_at%></td>
        <td><%= user.updated_at%></td>
        <td width="100">
          <button
            type="button"
            class="btn btn-primary"
            data-bs-toggle="modal"
            data-bs-target="#data<%= user.ID%>"
            data-bs-whatever="@edit"
          >
            編輯
          </button>
        </td>
      </tr>
      <% }); %>
    </tbody>
  </table>
  <% allUser.forEach((user, index) => { %>
  <div
    class="modal fade"
    id="data<%= user.ID%>"
    tabindex="-1"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">修改用戶資料</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="newUsername" class="col-form-label">Username:</label>
              <input
                type="text"
                name="newUsername"
                class="form-control"
                id="newUsername"
                value="<%= user.username%>"
              />
            </div>
            <div class="mb-3">
              <label for="newEmail" class="col-form-label">Email:</label>
              <input
                type="email"
                name="newEmail"
                class="form-control"
                id="newEmail"
                value="<%= user.email%>"
              />
            </div>
            <div class="mb-3">
              <label for="newRole" class="col-form-label">Role:</label>
              <select
                id="newRole"
                name="newRole"
                class="form-select"
                aria-label="Default select"
                value="<%= user.role%>"
              >
                <option selected disabled>
                  Open this select Role(current Role: <%= user.role%>)
                </option>
                <option value="superadmin">superAdmin</option>
                <option value="admin">Admin</option>
                <option value="member">Member</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Close
          </button>
          <button
            type="button"
            class="btn btn-primary"
            id="updateUserInfoBtn"
            data-userid="data-<%= user.ID %>"
          >
            Save
          </button>
        </div>
      </div>
    </div>
  </div>
  <% }); %>
</main>

<script>
  const btn = document.getElementById('updateUserInfoBtn');
  console.log(btn);
  btn.addEventListener('click', function (e) {
    console.log(e.target.dataset.userid);
  });
  //console.log(updateUserInfoData);

  /*     axios
        .patch('http://127.0.0.1:8080/admin/membersinfo', updateUserInfoData)
        .then(res => {
          console.log(res);
        })
        .catch(err => {
          console.log(err);
        }); */
</script>
